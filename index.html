	<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowRead - Leitor Inteligente</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f5f7fa; --card-bg-color: #ffffff; --text-color: #2c3e50;
            --heading-color: #1a2533; --primary-color: #4a69bd; --primary-hover-color: #3b5496;
            --secondary-color: #788a9e; --border-color: #dfe4ea; --shadow-color: rgba(0, 0, 0, 0.07);
            --success-color: #27ae60; --font-family: 'Poppins', 'Segoe UI', sans-serif;
            --border-radius: 16px; --card-padding: 25px;
        }
        body.dark-mode {
            --bg-color: #1a2533; --card-bg-color: #2c3e50; --text-color: #e0e5eb;
            --heading-color: #ffffff; --border-color: #41546b; --shadow-color: rgba(0, 0, 0, 0.15);
        }
        body { font-family: var(--font-family); background: var(--bg-color); color: var(--text-color); margin: 0; padding: 20px; display: flex; justify-content: center; transition: background 0.3s, color 0.3s; }
        .container { width: 100%; max-width: 1400px; display: grid; grid-template-columns: 400px 1fr; gap: 25px; }
        header { grid-column: 1 / -1; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        header h1 { color: var(--heading-color); margin: 0; font-size: 2.2rem; }
        header h1 span { color: var(--primary-color); }
        .controls-column { display: flex; flex-direction: column; gap: 25px; }
        .card { background: var(--card-bg-color); border-radius: var(--border-radius); padding: var(--card-padding); box-shadow: 0 8px 30px var(--shadow-color); transition: all 0.3s ease; }
        .card h3 { margin: 0 0 15px 0; color: var(--heading-color); font-size: 1.1rem; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }
        textarea, input[type="text"], input[type="number"], select { width: 100%; padding: 12px 15px; border-radius: 10px; border: 1px solid var(--border-color); font-size: 15px; background: var(--bg-color); color: var(--text-color); transition: all 0.2s ease; box-sizing: border-box; margin-bottom: 10px; }
        textarea:focus, input:focus, select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary-color) 20%, transparent); }
        #rawText { height: 120px; resize: vertical; }
        #processedText { height: 150px; resize: vertical; margin-top: 15px;}
        .button-group { display: flex; flex-wrap: wrap; gap: 10px; }
        button { background-color: var(--primary-color); color: #fff; border: none; border-radius: 10px; cursor: pointer; font-weight: 500; padding: 10px 15px; font-size: 15px; font-family: inherit; transition: all 0.2s ease; display: flex; align-items: center; gap: 8px; }
        button:hover { background-color: var(--primary-hover-color); transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); }
        .alignment-btn { background-color: var(--secondary-color); flex-grow: 1; }
        .alignment-btn.active { background-color: var(--primary-hover-color); transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); }
        button.secondary { background-color: var(--secondary-color); }
        button.secondary:hover { background-color: #5f7184; }
        button.success { background-color: var(--success-color); }
        button.success:hover { background-color: #219a52; }
        label { display: block; margin-bottom: 5px; font-weight: 500; } .config-group { display: flex; gap: 15px; align-items: center; margin-bottom: 10px; } .config-group label { margin-bottom: 0; } .config-group input, .config-group select { margin-bottom: 0; }
        .reader-column { display: flex; flex-direction: column; gap: 25px; }
        
        .motivation { color: var(--success-color); font-weight: bold; animation: fadeIn 0.8s ease-in-out; } @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        /* --- ESTILO DO DARK MODE E AUTO MODE TOGGLE (UNIFICADO) --- */
        .switch { 
            position: relative; 
            display: inline-block; 
            width: 60px; 
            height: 34px; 
            margin: 0 5px; /* Pequeno espaÃ§amento lateral */
        } 
        .switch input { 
            opacity: 0; 
            width: 0; 
            height: 0; 
        } 
        .slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background-color: var(--secondary-color); 
            transition: .4s; 
            border-radius: 34px; 
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
        } 
        .slider:before { 
            position: absolute; 
            content: ""; 
            height: 26px; 
            width: 26px; 
            left: 4px; 
            bottom: 4px; 
            background-color: white; 
            transition: .4s; 
            border-radius: 50%; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        } 
        /* Cor de Ativo (padrÃ£o para ambos os switches) */
        input:checked + .slider { 
            background-color: var(--primary-color); 
        } 
        input:checked + .slider:before { 
            transform: translateX(26px); 
        }
        /* Ãcones para o Dark Mode */
        #darkModeToggle:not(:checked) + .slider:after { content: 'â˜€ï¸'; position: absolute; top: 50%; right: 8px; transform: translateY(-50%); font-size: 14px; transition: opacity 0.4s; }
        #darkModeToggle:checked + .slider:after { content: 'ğŸŒ™'; position: absolute; top: 50%; left: 8px; transform: translateY(-50%); font-size: 14px; color: #fff; transition: opacity 0.4s; right: auto; }
        /* Ãcones para o Auto Mode */
        #autoModeSwitch:not(:checked) + .slider:after { content: 'M'; position: absolute; top: 50%; right: 10px; transform: translateY(-50%); font-size: 14px; font-weight: bold; color: white; transition: opacity 0.4s; }
        #autoModeSwitch:checked + .slider { background-color: var(--success-color); }
        #autoModeSwitch:checked + .slider:after { content: 'A'; position: absolute; top: 50%; left: 10px; transform: translateY(-50%); font-size: 14px; font-weight: bold; color: white; transition: opacity 0.4s; right: auto; }


        /* --- CORREÃ‡ÃƒO DO FLEXBOX VERTICAL E LATERAL (CONTROLES DE LEITURA) --- */
        
        .reader-container {
            display: flex; 
            gap: 25px; 
            align-items: flex-start; 
            width: 100%; 
        }
        
        .reader-container #output { 
            flex-grow: 1; 
            min-height: 350px; 
            padding: 50px; 
            background: var(--card-bg-color); 
            border-radius: var(--border-radius);
            box-shadow: 0 8px 30px var(--shadow-color);
            font-size: 28px; 
            line-height: 1.6;
            color: var(--heading-color);
            display: flex; 
            align-items: center;
            justify-content: center;
            text-align: center;
            overflow-wrap: break-word; 
            white-space: pre-wrap;
            border: 1px solid var(--border-color);
        }

        .controls-vertical {
            display: flex;
            flex-direction: column; 
            gap: 10px; 
            padding: 15px 10px; 
            background-color: var(--card-bg-color);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px var(--shadow-color);
            align-self: flex-start; 
            flex-shrink: 0; 
        }
        
        .controls-vertical button {
            width: 50px; 
            height: 50px; 
            font-size: 1.4em; 
            border-radius: 50%; 
            background-color: var(--primary-color);
            color: white;
            padding: 0; 
            display: flex; 
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s, transform 0.2s;
            box-shadow: none; 
            line-height: 1; 
        }
        .controls-vertical button:hover {
            background-color: var(--primary-hover-color);
            transform: scale(1.05); 
        }

        /* O botÃ£o AutoMode antigo foi substituÃ­do por um switch no card de ConfiguraÃ§Ãµes */
        
        .search-container button {
            width: 50px; 
            height: 50px; 
            font-size: 1.2em; 
            border-radius: 50%; 
            padding: 0;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .search-container input {
            margin-bottom: 0; 
        }
        
        /* --- ESTILOS DO MODAL/EDITOR MANUAL --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: var(--card-bg-color);
            border-radius: var(--border-radius);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            max-width: 800px;
            width: 90%;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            border-bottom: 1px solid var(--border-color);
        }
        .modal-header h3 {
            margin: 0;
            color: var(--heading-color);
        }
        .modal-close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--secondary-color);
            transition: color 0.2s;
        }
        .modal-close-btn:hover {
            color: var(--primary-color);
        }
        .editor-list {
            padding: 20px 25px;
            overflow-y: auto;
            flex-grow: 1;
        }
        .editor-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
			/* Ajusta o item do editor para usar flexbox, alinhando o parÃ¡grafo e os botÃµes */
.editor-item {
    display: flex;
    align-items: center; /* Alinha verticalmente */
    gap: 10px;
    margin-bottom: 12px;
    padding: 10px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: var(--bg-color);
}

/* Container para os botÃµes */
.editor-item-controls {
    display: flex;
    gap: 5px; /* EspaÃ§o entre os botÃµes + e X */
    flex-shrink: 0; /* Impede que os botÃµes encolham */
}

/* Estilo base para os botÃµes do editor */
.editor-item-controls button {
    border: none;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    font-size: 1.1em;
    cursor: pointer;
    line-height: 1;
    padding: 0;
    color: white;
    transition: background-color 0.2s;
}
.editor-item-controls button:hover {
    transform: none;
    box-shadow: none;
}

/* Estilo especÃ­fico para o botÃ£o de ADICIONAR (+) */
.add-period-btn {
    background-color: var(--success-color); /* Verde */
}
.add-period-btn:hover {
    background-color: #219a52;
}

/* Estilo especÃ­fico para o botÃ£o de DELETAR (X) */
.delete-period-btn {
    background-color: #e74c3c; /* Vermelho */
}
.delete-period-btn:hover {
    background-color: #c0392b;
}
			
			
			
        }
        .editor-item p {
            flex-grow: 1;
            margin: 0;
            padding: 5px;
            border-radius: 4px;
            min-height: 1.2em;
            outline: none;
            color: var(--text-color);
            transition: background-color 0.2s;
        }
        .editor-item p:focus {
            background-color: color-mix(in srgb, var(--primary-color) 5%, transparent);
            border: 1px dashed var(--primary-color);
        }
        .delete-period-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 1.1em;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            transition: background-color 0.2s;
            flex-shrink: 0;
        }
        .delete-period-btn:hover {
            background-color: #c0392b;
            transform: none;
            box-shadow: none;
        }
        .editor-footer {
            padding: 15px 25px;
            border-top: 1px solid var(--border-color);
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Flow<span>Read</span></h1>
            <label class="switch">
                <input type="checkbox" id="darkModeToggle">
                <span class="slider"></span>
            </label>
        </header>

        <aside class="controls-column">
            <div class="card">
                <h3>1. Insira seu Texto <span id="rawTextCounter" class="secondary" style="font-size: 0.8rem; font-weight: 400; color: var(--secondary-color);"></span></h3>
               <textarea id="rawText" rows="6" placeholder="Cole seu texto aqui..." oninput="updateCounters()"></textarea>
                <div class="button-group">
                    <button onclick="pasteFromClipboard()">ğŸ“‹ Colar</button>
                    <button onclick="openManualEditor()">âœ‚ï¸ Editar Texto</button>
                    <button onclick="importFromLink()">ğŸ“ Importar de Link</button>
                    <button onclick="clearRawText()" class="secondary">ğŸ—‘ï¸ Limpar</button>
                </div>
				
				
				<div style="margin-top: 15px;">
                    <label for="summaryPercent">Tamanho do Resumo (em % de frases)</label>
                    <input type="number" id="summaryPercent" value="25" min="5" max="80" step="5" style="width: 100px; display: inline-block;">
                </div>

                <div class="button-group" style="margin-top: 15px;">
                    <button onclick="generateSentences()">ğŸ“Œ Gerar Frases</button>
                    <button onclick="generateSmartSummary()">ğŸ“ Resumo Inteligente</button>
                </div>
            </div>
            <div class="card">
               <h3>2. Revise e Edite <span id="processedTextCounter" class="secondary" style="font-size: 0.8rem; font-weight: 400; color: var(--secondary-color);"></span></h3>
                <textarea id="processedText" placeholder="Frases extraÃ­das ou resumidas aparecerÃ£o aqui." oninput="updateCounters()"></textarea>
                <div class="button-group">
                    <button onclick="syncProcessedText()">ğŸ”„ Sincronizar EdiÃ§Ãµes</button>
                </div>
            </div>
            <div class="card">
                <h3>âš™ï¸ ConfiguraÃ§Ãµes de Leitura</h3>
                <label for="voiceSelect">Voz</label>
                <select id="voiceSelect"></select>
                <div class="config-group" style="margin-bottom: 20px;">
                    <label style="font-weight: bold;">Modo AutomÃ¡tico:</label>
                    <label class="switch" style="margin-left: auto;">
                         <input type="checkbox" id="autoModeSwitch" onclick="toggleAutoMode()">
                         <span class="slider"></span>
                    </label>
                </div>

                <div class="config-group">
                    <label>Velocidade: <input type="number" id="voiceRate" value="1" min="0.1" max="3" step="0.1"></label>
                    <label>Tamanho: <input type="number" id="fontSize" value="28" min="12" max="60"></label>
                </div>
                <div class="config-group">
                    <label for="fontColor">Cor:</label>
                    <input type="color" id="fontColor" value="#1a2533">
                </div>
                <label for="fontFamily">Fonte</label>
                <select id="fontFamily">
                  <option value="Poppins, sans-serif">Poppins</option>
                  <option value="Georgia, serif">Georgia</option>
                  <option value="Arial, sans-serif">Arial</option>
                  <option value="Courier New, monospace">Courier New</option>
                  <option value="Verdana, sans-serif">Verdana</option>
                </select>
                <label style="margin-top: 15px;">Alinhamento do Texto</label>
                <div class="button-group">
                    <button class="alignment-btn" onclick="alignText('left', this)">Esquerda</button>
                    <button class="alignment-btn" onclick="alignText('justify', this)">Justificar</button>
                    <button class="alignment-btn" onclick="alignText('right', this)">Direita</button>
                </div>
                <label style="margin-top: 15px;">Frases Motivacionais</label>
                <div class="config-group">
                    <label>A cada <input type="number" id="motivationEvery" value="0" min="0" style="width:60px"> frases</label>
                </div>
            </div>
            <div class="card">
                <h3>ğŸ’¾ Gerenciamento</h3>
                <div class="button-group">
                    <button onclick="exportJSON()">ğŸ“¥ Exportar JSON</button>
                    <label for="importFile" class="button secondary" style="cursor:pointer;">ğŸ“¤ Importar JSON</label>
                    <input type="file" id="importFile" onchange="importJSON(event)" style="display:none;">
                </div>
                 <div class="button-group" style="margin-top: 10px;">
                    <button onclick="saveToCloud()" class="success">â˜ï¸ Salvar e Copiar Link</button>
                    <button onclick="loadBinByLink()">ğŸ“‚ Carregar da Nuvem</button>
                </div>
            </div>
        </aside>

        <main class="reader-column">
            <div class="reader-container">
                <div id="output">
                    Bem-vindo ao FlowRead! Cole um texto e gere frases para comeÃ§ar.
                </div>

                <div class="controls-vertical">
                    <button id="playPauseBtn" onclick="playPauseToggle()" title="Play/Pause">â–¶ï¸</button>
					<button id="stopBtn" onclick="stopReading()" title="Parar Leitura">â¹ï¸</button>
                    <button id="nextBtn" onclick="nextSentence()" title="PrÃ³xima Frase">â­ï¸</button>
                    <button id="prevBtn" onclick="prevSentence()" title="Frase Anterior">â®ï¸</button>
                    
                    <button id="voiceToggleBtn" onclick="toggleVoice()" title="Voz On/Off">ğŸ—£ï¸</button>
                    </div>
            </div>	
			
            <div class="card">
                 <h3>Pesquisa RÃ¡pida</h3>
                 <div class="search-container" style="display: flex; gap: 10px; align-items: center;">
                     <input type="text" id="searchInput" placeholder="Pesquisar termo no Google...">
                     <button onclick="searchGoogle()">ğŸ”</button>
                 </div>
            </div>
        </main>
    </div>

    <div id="manual-editor-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content editor-modal">
            <div class="modal-header">
                <h3>Editor de PerÃ­odos</h3>
                <button class="modal-close-btn" onclick="closeManualEditor()">&times;</button>
            </div>
            <div id="editor-list" class="editor-list"></div>
            <div class="editor-footer">
                <button class="success" onclick="saveManualChanges()">âœ“ Salvar AlteraÃ§Ãµes e Fechar</button>
            </div>
        </div>
    </div>

<script>
// =======================================================
// LÃ“GICA DO DARK MODE E OUTRAS MELHORIAS
// =======================================================
document.addEventListener('DOMContentLoaded', () => {
Â  Â  const darkModeToggle = document.getElementById('darkModeToggle');
Â  Â  const body = document.body;
Â  Â  const fontColorInput = document.getElementById('fontColor');
Â  Â Â 
Â  Â  function applyTheme(isDark) {
Â  Â  Â  Â  if (isDark) {
Â  Â  Â  Â  Â  Â  body.classList.add('dark-mode');
Â  Â  Â  Â  Â  Â  // SÃ³ muda a cor se a cor atual for a padrÃ£o Light
Â  Â  Â  Â  Â  Â  if (fontColorInput.value === '#1a2533') {Â 
Â  Â  Â  Â  Â  Â  Â  Â  fontColorInput.value = '#ffffff';Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  body.classList.remove('dark-mode');
Â  Â  Â  Â  Â  Â  // SÃ³ muda a cor se a cor atual for a padrÃ£o Dark
Â  Â  Â  Â  Â  Â  if (fontColorInput.value === '#ffffff') {Â 
Â  Â  Â  Â  Â  Â  Â  Â  fontColorInput.value = '#1a2533';Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }
Â  Â  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
Â  Â  if(darkModeToggle) {
Â  Â  Â  Â  darkModeToggle.checked = prefersDark;
Â  Â  Â  Â  applyTheme(prefersDark);
Â  Â  Â  Â  darkModeToggle.addEventListener('change', () => {
Â  Â  Â  Â  Â  Â  applyTheme(darkModeToggle.checked);
Â  Â  Â  Â  Â  Â  if (typeof showCurrent === 'function') showCurrent();
Â  Â  Â  Â  });
Â  Â  }
Â  Â  loadVoices();
	const rawTextarea = document.getElementById('rawText');
Â  Â  if (rawTextarea && rawTextarea.value.trim() === '') {
Â  Â  Â  Â  rawTextarea.value = `O rover Curiosity, da NASA, pousou em Marte em 2012 para investigar o passado geolÃ³gico do planeta.
A missÃ£o do Curiosity Ã© determinar se Marte jÃ¡ teve as condiÃ§Ãµes ambientais necessÃ¡rias para sustentar vida microbiana.
Para isso, o Curiosity explora a cratera Gale, onde ele tem coletado amostras de solo e rochas.
Recentemente, o Curiosity encontrou evidÃªncias de Ã¡gua e compostos orgÃ¢nicos, o que reforÃ§a a possibilidade de vida no passado de Marte.
O Curiosity continua sua exploraÃ§Ã£o, enviando dados valiosos sobre a histÃ³ria do planeta vermelho.`;
Â  Â  }
	updateCounters();Â 
Â  Â  // Garante que o estado do switch seja refletido no JS
Â  Â  document.getElementById('autoModeSwitch').checked = autoMode;
});

// =======================================================
// VARIÃVEIS GLOBAIS E CONSTANTES
// =======================================================
let sentences=[], currentIndex=0, autoMode=false, voiceEnabled=true;
let voices=[], selectedVoice=null, textReadCounts={};
let cloudLink = "";
const output=document.getElementById('output');Â 
const voiceSelect=document.getElementById('voiceSelect');
const rawTextArea = document.getElementById('rawText');
const motivationalPhrases=["Continue firme, vocÃª estÃ¡ indo bem!","Mais uma frase! Foque e avance!","VocÃª estÃ¡ se superando a cada leitura!","Mantenha o ritmo, sua mente agradece!","A constÃ¢ncia traz o resultado!","Respire fundo, vocÃª estÃ¡ no caminho certo!","Seu foco estÃ¡ criando resultados!"];

function sent_tokenize_browser(text) {
Â  Â  return text.match(/[^.!?]+[.!?]+/g) || [text.trim()];
}

const stopWordsPt = new Set([
Â  Â  'de', 'do', 'da', 'e', 'a', 'o', 'que', 'em', 'um', 'uma', 'para', 'com', 'nÃ£o', 'se', 'por', 'os', 'as', 'no', 'na', 'dos', 'das',
Â  Â  'ao', 'aos', 'meu', 'minha', 'seu', 'sua', 'nosso', 'nossa', 'dele', 'dela', 'este', 'esta', 'isto',Â 
Â  Â  'aquele', 'aquela', 'aquilo', 'ser', 'foi', 'fui', 'somos', 'sou', 'sÃ£o', 'vocÃª',Â 
Â  Â  'ele', 'ela', 'nÃ³s', 'vÃ³s', 'eles', 'elas', 'que', 'quem', 'onde', 'qual', 'quais',
Â  Â  '.', ',', ':', ';', '!', '?', '(', ')', '[', ']', '{', '}', '"', "'", '-', 'â€”',Â 
Â  Â  '0', '1', '2', '3', '4', '5', '6', '7', '8', '9'
]);

function calcularTermFrequency(texto) {
Â  Â  const frequencia = {};
Â  Â  const palavras = texto.toLowerCase().split(/[\s\n]+/);
Â  Â  for (let palavra of palavras) {
Â  Â  Â  Â  const palavraLimpa = palavra.replace(/[.,:;!?()"']/g, '');Â 
Â  Â  Â  Â  if (palavraLimpa.length > 1 && !stopWordsPt.has(palavraLimpa)) {
Â  Â  Â  Â  Â  Â  frequencia[palavraLimpa] = (frequencia[palavraLimpa] || 0) + 1;
Â  Â  Â  Â  }
Â  Â  }
Â  Â  const maxFrequencia = Math.max(...Object.values(frequencia));
Â  Â  if (maxFrequencia === 0) return {};
Â  Â  for (let palavra in frequencia) {
Â  Â  Â  Â  frequencia[palavra] /= maxFrequencia;
Â  Â  }
Â  Â  return frequencia;
}

function calcularInverseSentenceFrequency(frases, tf) {
Â  Â  const isf = {};
Â  Â  const totalFrases = frases.length;
Â  Â  const contagemFrases = {};
Â  Â  for (const frase of frases) {
Â  Â  Â  Â  const palavrasUnicas = new Set();
Â  Â  Â  Â  frase.toLowerCase().split(/[\s\n]+/).forEach(w => {
Â  Â  Â  Â  Â  Â  const palavraLimpa = w.replace(/[.,:;!?()"']/g, '');
Â  Â  Â  Â  Â  Â  if (tf[palavraLimpa]) {
Â  Â  Â  Â  Â  Â  Â  Â  palavrasUnicas.add(palavraLimpa);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â  palavrasUnicas.forEach(palavra => {
Â  Â  Â  Â  Â  Â  contagemFrases[palavra] = (contagemFrases[palavra] || 0) + 1;
Â  Â  Â  Â  });
Â  Â  }
Â  Â  for (const palavra in contagemFrases) {
Â  Â  Â  Â  isf[palavra] = Math.log10(totalFrases / contagemFrases[palavra]);
Â  Â  }
Â  Â  return isf;
}

function aplicarPesoEstrutural(pontuacaoFrases, totalFrases) {
Â  Â  const pesoPercentual = 0.2;Â 
Â  Â  const numFrasesBonus = Math.ceil(totalFrases * pesoPercentual);
Â  Â  const bonus = 0.25;Â 
Â  Â  for (let i = 0; i < totalFrases; i++) {
Â  Â  Â  Â  let b = 0;
Â  Â  Â  Â  if (i < numFrasesBonus) {
Â  Â  Â  Â  Â  Â  b = pontuacaoFrases[i] * bonus;Â 
Â  Â  Â  Â  } else if (i >= totalFrases - numFrasesBonus) {
Â  Â  Â  Â  Â  Â  b = pontuacaoFrases[i] * bonus;
Â  Â  Â  Â  }
Â  Â  Â  Â  pontuacaoFrases[i] += b;
Â  Â  }
Â  Â  return pontuacaoFrases;Â 
}

function gerarResumo(textoOriginal) {
Â  Â  const frases = sent_tokenize_browser(textoOriginal.trim());
Â  Â  const totalFrases = frases.length;
Â  Â  const percentual = document.getElementById('summaryPercent')?.value || 25;Â 
Â  Â  let numFrasesDesejadas = Math.ceil(totalFrases * (percentual / 100));
Â  Â  numFrasesDesejadas = Math.max(1, numFrasesDesejadas);
Â  Â  const frasesParaExtrair = Math.min(totalFrases, numFrasesDesejadas);
Â  Â  if (totalFrases === 0) { return "Texto muito curto ou sem palavras relevantes."; }
Â  Â  const tf = calcularTermFrequency(textoOriginal);
Â  Â  if (Object.keys(tf).length === 0) { return "Texto muito curto ou sem palavras relevantes."; }
Â  Â  const isf = calcularInverseSentenceFrequency(frases, tf);
Â  Â  const pontuacaoPalavras = {};
Â  Â  for (const palavra in tf) { pontuacaoPalavras[palavra] = tf[palavra] * (isf[palavra] || 0); }
Â  Â  const pontuacaoFrases = {};
Â  Â  frases.forEach((frase, i) => {
Â  Â  Â  Â  let score = 0;
Â  Â  Â  Â  frase.toLowerCase().split(/[\s\n]+/).forEach(w => {
Â  Â  Â  Â  Â  Â  const palavraLimpa = w.replace(/[.,:;!?()"']/g, '');
Â  Â  Â  Â  Â  Â  score += (pontuacaoPalavras[palavraLimpa] || 0);Â 
Â  Â  Â  Â  });
Â  Â  Â  Â  pontuacaoFrases[i] = score;
Â  Â  });
Â  Â  const pontuacaoFinal = aplicarPesoEstrutural(pontuacaoFrases, totalFrases);
Â  Â  const frasesOrdenadas = Object.keys(pontuacaoFinal)
Â  Â  Â  Â  .map(i => [parseInt(i), pontuacaoFinal[i]])
Â  Â  Â  Â  .sort((a, b) => b[1] - a[1]);
Â  Â  const indicesResumo = frasesOrdenadas
Â  Â  Â  Â  .slice(0, frasesParaExtrair)
Â  Â  Â  Â  .map(item => item[0])
Â  Â  Â  Â  .sort((a, b) => a - b);
Â  Â  const resumo = indicesResumo
Â  Â  Â  Â  .map(i => frases[i].trim())
Â  Â  Â  Â  .join(' ');
Â  Â  return resumo;
}

function loadVoices(){Â  Â  Â 
Â  Â  // 1. ObtÃ©m todas as vozes disponÃ­veis no sistema do usuÃ¡rio
Â  Â  voices = speechSynthesis.getVoices();Â  Â  Â 
Â  Â  if(!voiceSelect) return;Â  Â Â 
Â  Â Â 
Â  Â  voiceSelect.innerHTML = ""; // Limpa a lista atualÂ  Â  Â 
Â  Â Â 
Â  Â  // --- NOVIDADE: Adiciona a opÃ§Ã£o "AutomÃ¡tico" (fallback do sistema) ---
Â  Â  let defaultOption = document.createElement("option");
Â  Â  defaultOption.value = -1; // Usamos -1 para sinalizar o modo AutomÃ¡tico
Â  Â  defaultOption.textContent = "AutomÃ¡tico (PadrÃ£o do Sistema)";
Â  Â  voiceSelect.appendChild(defaultOption);

Â  Â  // 2. Adiciona todas as vozes encontradas ao seletor
Â  Â  voices.forEach((v,i) => {Â  Â  Â  Â  Â 
Â  Â  Â  Â  let o = document.createElement("option");Â  Â  Â  Â  Â 
Â  Â  Â  Â  o.value = i;Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Exibe o nome da voz e o idioma (Ex: 'Google Portuguese (pt-BR)')
Â  Â  Â  Â  o.textContent = `${v.name} (${v.lang})`;Â  Â  Â  Â  Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // NOVIDADE: Adiciona um Ã­cone de estrela para vozes em portuguÃªs (pt-BR)
Â  Â  Â  Â  if (v.lang.startsWith('pt-')) {
Â  Â  Â  Â  Â  Â  o.textContent = `â­ ${o.textContent}`;
Â  Â  Â  Â  }

Â  Â  Â  Â  voiceSelect.appendChild(o);Â  Â  Â 
Â  Â  });Â  Â  Â 
Â  Â Â 
Â  Â  // 3. Define a voz padrÃ£o apÃ³s carregar todas as opÃ§Ãµes
Â  Â  if(voices.length > 0) {
Â  Â  Â  Â  // Tenta encontrar a primeira voz em portuguÃªs como padrÃ£o
Â  Â  Â  Â  const ptVoiceIndex = voices.findIndex(v => v.lang.startsWith('pt-'));

Â  Â  Â  Â  if (ptVoiceIndex !== -1) {
Â  Â  Â  Â  Â  Â  selectedVoice = voices[ptVoiceIndex];
Â  Â  Â  Â  Â  Â  voiceSelect.value = ptVoiceIndex;Â 
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // Se nÃ£o houver portuguÃªs, usa a primeira voz e define o valor no seletor.
Â  Â  Â  Â  Â  Â  selectedVoice = voices[0];
Â  Â  Â  Â  Â  Â  voiceSelect.value = 0;
Â  Â  Â  Â  }
Â  Â  } else {
Â  Â  Â  Â  // Se nÃ£o houver vozes, seleciona a opÃ§Ã£o AutomÃ¡tico.
Â  Â  Â  Â  selectedVoice = null;
Â  Â  Â  Â  voiceSelect.value = -1;
Â  Â  }
}

speechSynthesis.onvoiceschanged = loadVoices;
voiceSelect.addEventListener("change", () => {Â 
Â  Â  const index = parseInt(voiceSelect.value);
Â  Â  // Se o valor for -1, selectedVoice Ã© null (AutomÃ¡tico). Caso contrÃ¡rio, Ã© a voz selecionada.
Â  Â  selectedVoice = (index === -1) ? null : voices[index];Â 
});





function generateSentences(){Â 
Â  Â  stopReading();Â 
Â  Â  const text=document.getElementById('rawText').value;Â 
Â  Â  if(!text.trim()) return;Â 
Â  Â  sentences=sent_tokenize_browser(text).map(s=>s.trim()).filter(Boolean);Â 
Â  Â  sentences=insertMotivation(sentences);Â 
Â  Â  currentIndex=0;Â 
Â  Â  document.getElementById('processedText').value=sentences.join("\n\n");Â 
Â  Â  showCurrent();Â 
}

function generateSmartSummary(){Â 
Â  Â  stopReading();Â 
Â  Â  const text=document.getElementById('rawText').value;Â 
Â  Â  if(!text.trim()) return;Â 
Â  Â  const resumoText = gerarResumo(text);
Â  Â  if (resumoText.includes("muito curto")) {
Â  Â  Â  Â  alert("O texto Ã© muito curto ou nÃ£o tem palavras suficientes para resumir.");
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  document.getElementById('processedText').value = resumoText;
Â  Â  sentences = sent_tokenize_browser(resumoText).map(s=>s.trim()).filter(Boolean);
Â  Â  sentences = insertMotivation(sentences);
Â  Â  currentIndex=0;
Â  Â  alert(`Resumo gerado com sucesso! ${sentences.length} frases selecionadas.`);
Â  Â  showCurrent();
	updateCounters();
}

function syncProcessedText(){Â 
Â  Â  stopReading();Â 
Â  Â  const edited=document.getElementById('processedText').value;Â 
Â  Â  sentences=edited.split(/\n\s*\n/).map(s=>s.trim()).filter(Boolean);Â 
Â  Â  currentIndex=0;Â 
Â  Â  showCurrent();Â 
Â  Â  updateCounters();Â 
}

function insertMotivation(arr){ const every=parseInt(document.getElementById('motivationEvery').value)||0; if(every<=0) return arr; let final=[]; for(let i=0;i<arr.length;i++){ final.push(arr[i]); if((i+1)%every===0 && i!==arr.length-1){ final.push(motivationalPhrases[Math.floor(Math.random()*motivationalPhrases.length)]); } } return final; }

function clearRawText(){Â 
Â  Â  stopReading();Â 
Â  Â  document.getElementById('rawText').value="";Â 
Â  Â  document.getElementById('processedText').value="";Â 
Â  Â  sentences=[];Â 
Â  Â  output.textContent="Texto apagado.";Â 
Â  Â  updateCounters();
}

function searchGoogle(){ const q=document.getElementById('searchInput').value.trim(); if(q) window.open(`https://www.google.com/search?q=${encodeURIComponent(q)}`, "_blank"); else { alert("Digite algo para pesquisar."); document.getElementById('searchInput').focus(); } }

async function importFromLink(){ const url=prompt("Cole o link do site (modo texto recomendado):"); if(!url) return; try{ const res=await fetch(`http://localhost:3000/extract-text?url=${encodeURIComponent(url)}`); const data=await res.json(); if(data.text){ document.getElementById('rawText').value=data.text; alert("Texto extraÃ­do com sucesso!"); } else alert("NÃ£o foi possÃ­vel extrair o texto."); } catch(err){ alert("Erro ao importar o texto: "+err.message); } }

function showCurrent(){Â 
Â  Â  // Se nÃ£o houver frases, exibe mensagem de erro.
Â  Â  if(!sentences || !sentences.length){Â 
Â  Â  Â  Â  output.textContent="Nenhuma frase gerada.";Â 
Â  Â  Â  Â  return;Â 
Â  Â  }Â 
Â  Â Â 
Â  Â  // Configura estilos
Â  Â  const fontSize = document.getElementById('fontSize')?.value || 28;Â 
Â  Â  const fontColor = document.getElementById('fontColor')?.value || '#1a2533';Â 
Â  Â  const fontFamily = document.getElementById('fontFamily')?.value || 'Poppins, sans-serif';Â 
Â  Â  output.style.fontSize=fontSize + "px";Â 
Â  Â  output.style.color=fontColor;Â 
Â  Â  output.style.fontFamily=fontFamily;Â 
Â  Â  output.style.textAlign = output.style.textAlign || 'center';Â 
Â  Â Â 
Â  Â  // Exibe a frase atual, aplicando estilo se for motivacional
Â  Â  const text=sentences[currentIndex];Â 
Â  Â  if(motivationalPhrases.includes(text)) {
Â  Â  Â  Â  output.innerHTML=`<span class="motivation">${text}</span>`;Â 
Â  Â  } else {
Â  Â  Â  Â  output.textContent=text;
Â  Â  }
Â  Â Â 
Â  Â  // âŒ REMOVIDO: LÃ³gica que redefinia o Ã­cone do Play/Pause.
Â  Â  // Isso deve ser tratado apenas nas funÃ§Ãµes de controle de voz.
}

function alignText(alignment, clickedButton) {Â 
Â  Â  document.getElementById('output').style.textAlign = alignment;Â 
Â  Â  document.querySelectorAll('.alignment-btn').forEach(btn => btn.classList.remove('active'));Â 
Â  Â  clickedButton.classList.add('active');
}

function speakCurrent() {Â 
Â  Â  const text = sentences[currentIndex];Â 
Â  Â Â 
Â  Â  // CORREÃ‡ÃƒO CRÃTICA: Apenas verifica se a voz estÃ¡ DESLIGADA ou o texto estÃ¡ vazio.Â 
Â  Â  // Se selectedVoice for null (Modo AutomÃ¡tico), o cÃ³digo segue para usar a voz padrÃ£o.
Â  Â  if (!voiceEnabled || !text.trim()) {Â 
Â  Â  Â  Â  if (autoMode) nextSentenceAuto(); // Chama a funÃ§Ã£o para tentar avanÃ§ar
Â  Â  Â  Â  return;Â 
Â  Â  }Â 
Â  Â Â 
Â  Â  speechSynthesis.cancel();Â 
Â  Â Â 
Â  Â  const utter = new SpeechSynthesisUtterance(text);Â 
Â  Â Â 
Â  Â  // CORREÃ‡ÃƒO ESSENCIAL: SÃ³ define utter.voice se uma voz especÃ­fica foi selecionada.
Â  Â  // Se selectedVoice for null, a API de Voz usarÃ¡ automaticamente a voz padrÃ£o do sistema,
Â  Â  // permitindo que a leitura inicie.
Â  Â  if (selectedVoice) {
Â  Â  Â  Â  utter.voice = selectedVoice;
Â  Â  }Â 
Â  Â Â 
Â  Â  const rate = parseFloat(document.getElementById('voiceRate')?.value) || 1;Â 
Â  Â  utter.rate = rate;Â 
Â  Â Â 
Â  Â  // --- LÃ³gica de InÃ­cio/Fim (Que estÃ¡ correta) ---
Â  Â  utter.onstart = () => {
Â  Â  Â  Â  document.getElementById('playPauseBtn').textContent = 'â¸ï¸';
Â  Â  Â  Â  output.style.border = '3px solid var(--primary-color)';
Â  Â  Â  Â  output.style.boxShadow = '0 0 20px color-mix(in srgb, var(--primary-color) 40%, transparent)';
Â  Â  };
Â  Â Â 
Â  Â  utter.onend = () => {Â 
Â  Â  Â  Â  output.style.border = '1px solid var(--border-color)';
Â  Â  Â  Â  output.style.boxShadow = '0 8px 30px var(--shadow-color)';

Â  Â  Â  Â  if (autoMode) {
Â  Â  Â  Â  Â  Â  // Chama a funÃ§Ã£o que avanÃ§a e reinicia a leitura
Â  Â  Â  Â  Â  Â  setTimeout(nextSentenceAuto, 200);Â 
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  document.getElementById('playPauseBtn').textContent = 'â–¶ï¸';Â 
Â  Â  Â  Â  }
Â  Â  };Â 
Â  Â Â 
Â  Â  // O tratamento de erro (interrupted) que removemos estÃ¡ correto e nÃ£o precisa de mais ajustes.
Â  Â  utter.onerror = (event) => {
Â  Â  Â  Â  if (event.error === 'interrupted') return; // Ignora interrupÃ§Ãµes intencionais
Â  Â  Â  Â Â 
Â  Â  Â  Â  console.error('SpeechSynthesis Error:', event.error);
Â  Â  Â  Â  alert(`Erro de voz: ${event.error}. Tentando avanÃ§ar...`);
Â  Â  Â  Â  document.getElementById('playPauseBtn').textContent = 'â–¶ï¸';Â 
Â  Â  Â  Â  if (autoMode) nextSentenceAuto();
Â  Â  };

Â  Â  // Certifica que a voz estÃ¡ ativada e tenta falar
Â  Â  if ('speechSynthesis' in window && !speechSynthesis.speaking) {
Â  Â  Â  Â  Â speechSynthesis.speak(utter);
Â  Â  } else if (speechSynthesis.speaking) {
Â  Â  Â  Â  Â speechSynthesis.cancel();
Â  Â  Â  Â  Â speechSynthesis.speak(utter);
Â  Â  }
}

// âš ï¸ CORRIGIDO: O Play/Pause nÃ£o liga mais o autoMode por padrÃ£o
function playPauseToggle() {
Â  Â  if (!sentences.length) {
Â  Â  Â  Â  alert("Gere frases primeiro!");
Â  Â  Â  Â  return;
Â  Â  }
Â  Â Â 
Â  Â  if (speechSynthesis.speaking && !speechSynthesis.paused) {
Â  Â  Â  Â  speechSynthesis.pause();
Â  Â  Â  Â  document.getElementById('playPauseBtn').textContent = 'â–¶ï¸';
Â  Â  } else if (speechSynthesis.paused) {
Â  Â  Â  Â  speechSynthesis.resume();
Â  Â  Â  Â  document.getElementById('playPauseBtn').textContent = 'â¸ï¸';
Â  Â  } else {
Â  Â  Â  Â  // Se nÃ£o estiver falando nem pausado, inicia a leitura na frase atual.
Â  Â  Â  Â  // NÃ£o altera o estado do autoMode.
Â  Â  Â  Â  if (currentIndex < 0 || currentIndex >= sentences.length) currentIndex = 0;
Â  Â  Â  Â  showCurrent();Â 
Â  Â  Â  Â  speakCurrent();Â 
Â  Â  }
}

function stopReading() {
Â  Â  // 1. Desliga o modo automÃ¡tico para impedir que a voz reinicie
Â  Â  autoMode = false;
    // Garante que o switch seja desligado visualmente
    document.getElementById('autoModeSwitch').checked = false;
Â  Â Â 
Â  Â  // 2. Cancela a sÃ­ntese de voz (para a leitura)
Â  Â  speechSynthesis.cancel();
Â  Â Â 
Â  Â  // 3. Garante que o Ã­cone volte para PLAY.
Â  Â  document.getElementById('playPauseBtn').textContent = 'â–¶ï¸';Â 
Â  Â Â 
Â  Â  // 4. Remove o estilo visual de "lendo"
Â  Â  const output = document.getElementById('output');
Â  Â  output.style.border = '1px solid var(--border-color)';Â 
Â  Â  output.style.boxShadow = '0 8px 30px var(--shadow-color)';Â 
}

// âš™ï¸ CORRIGIDO: FunÃ§Ã£o de toggle do Switch
function toggleAutoMode() {
Â  Â  autoMode = document.getElementById('autoModeSwitch').checked;
Â  Â Â 
Â  Â  if (autoMode) {
Â  Â  Â  Â  // Se ligar, inicia a leitura (se nÃ£o estiver lendo)
Â  Â  Â  Â  if (!speechSynthesis.speaking && !speechSynthesis.paused) {
Â  Â  Â  Â  Â  Â  if (currentIndex < 0 || currentIndex >= sentences.length) currentIndex = 0;
Â  Â  Â  Â  Â  Â  showCurrent();
Â  Â  Â  Â  Â  Â  speakCurrent();
Â  Â  Â  Â  }
Â  Â  } else {
Â  Â  Â  Â  // Se desligar o autoMode, para qualquer leitura em andamento
Â  Â  Â  Â  speechSynthesis.cancel();
Â  Â  Â  Â  document.getElementById('playPauseBtn').textContent = 'â–¶ï¸';Â 
Â  Â  }
}

/**
 * NOVO: Esta funÃ§Ã£o Ã© chamada automaticamente pelo 'utter.onend' quando o autoMode estÃ¡ ativo.
 */
function nextSentenceAuto(){Â 
Â  Â  if (!sentences.length || !autoMode) {
        stopReading();
        return;Â 
    }
Â  Â Â 
Â  Â  // Verifica se a frase atual Ã© a Ãºltima
Â  Â  const isLastSentence = currentIndex === sentences.length - 1;
Â  Â Â 
Â  Â  // AvanÃ§a o Ã­ndice (usando mÃ³dulo para garantir que nÃ£o saia do limite)
Â  Â  currentIndex = (currentIndex + 1) % sentences.length;Â 
Â  Â Â 
Â  Â  // Se era a Ãºltima frase, o currentIndex resetou para 0. Paramos o autoMode.
Â  Â  if (isLastSentence) {
        stopReading(); // Desliga autoMode e cancela fala.
Â  Â  Â  Â  return;
Â  Â  }
    
    // Mostra a prÃ³xima frase e fala.
    showCurrent();Â 
Â  Â  speakCurrent();Â 
}


function manualMode(){Â 
Â  Â  stopReading(); // Reutiliza a funÃ§Ã£o de parada total
Â  Â  showCurrent();Â 
}

function nextSentence(){Â 
Â  Â  if (!sentences.length) return;Â 
Â  Â  stopReading(); // Garante que o modo automÃ¡tico seja desativado ao avanÃ§ar
Â  Â  currentIndex=(currentIndex+1)%sentences.length;Â 
Â  Â  showCurrent();Â 
Â  Â  if(voiceEnabled) speakCurrent();Â 
}

function prevSentence(){Â 
Â  Â  if (!sentences.length) return;Â 
Â  Â  stopReading(); // Garante que o modo automÃ¡tico seja desativado ao recuar
Â  Â  currentIndex=(currentIndex-1+sentences.length)%sentences.length;Â 
Â  Â  showCurrent();Â 
Â  Â  if(voiceEnabled) speakCurrent();Â 
}
function toggleVoice(){Â 
Â  Â  voiceEnabled=!voiceEnabled;Â 
Â  Â  const voiceBtn = document.getElementById('voiceToggleBtn');
Â  Â  if (voiceBtn) {
Â  Â  Â  Â  voiceBtn.textContent = voiceEnabled ? 'ğŸ—£ï¸' : 'ğŸ”‡';
Â  Â  }
Â  Â  if (!voiceEnabled && (speechSynthesis.speaking || speechSynthesis.paused)) {
Â  Â  Â  Â  speechSynthesis.cancel();
Â  Â  Â  Â  document.getElementById('playPauseBtn').textContent = 'â–¶ï¸';Â 
Â  Â  Â  Â  alert("Voz desativada. Leitura de texto interrompida.");
Â  Â  } else if (voiceEnabled) {
Â  Â  Â  Â  Â alert("Voz ativada.");
Â  Â  }
}

function exportJSON(){ const data={sentences,textReadCounts:{}}; const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='flowread_data.json'; a.click(); URL.revokeObjectURL(url); }

function importJSON(event){ const file=event.target.files[0]; if(!file) return; const reader=new FileReader(); reader.onload=(e)=>{ try{ const data=JSON.parse(e.target.result); if(data.sentences) sentences=data.sentences; if(data.textReadCounts) textReadCounts=data.textReadCounts; currentIndex=0; document.getElementById('processedText').value=sentences.join("\n\n"); showCurrent(); alert("JSON importado com sucesso!"); }catch(err){ alert("Erro ao importar JSON: "+err); } }; reader.readAsText(file); }

const MASTER_KEY="$2a$10$2wR5NQoVsUWczmL.U8MAs.YILi4/aKD3YK01iPbnyFzfLn.xiChGK";
async function saveToCloud(){ try{ const data={sentences,textReadCounts:{}}; const res=await fetch("https://api.jsonbin.io/v3/b",{method:"POST",headers:{"Content-Type":"application/json","X-Master-Key":MASTER_KEY},body:JSON.stringify(data)}); const json=await res.json(); cloudLink=json.metadata.id; copyCloudLink(); } catch(err){ alert("Erro ao salvar na nuvem: "+err.message); }}
function copyCloudLink(){ if(!cloudLink){ alert("Nenhum JSON salvo ainda."); return; } const url="https://jsonbin.io/b/"+cloudLink; navigator.clipboard.writeText(url).then(()=>alert("Salvo! Link copiado."),()=>alert("Falha ao copiar."));}
async function loadBinByLink(){ const input = prompt("Cole o ID ou link do bin JSON:"); if(!input) return; let binId = input.includes("jsonbin.io") ? input.split("/b/")[1].split("/")[0] : input; try{ const res = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, { headers: {"X-Master-Key": MASTER_KEY} }); const json = await res.json(); if(json.record){ sentences = json.record.sentences || []; textReadCounts = json.record.textReadCounts || {}; currentIndex = 0; document.getElementById('processedText').value = sentences.join("\n\n"); showCurrent(); alert("Bin carregado com sucesso!"); } else alert("NÃ£o foi possÃ­vel carregar o bin."); } catch(err){ alert("Erro ao carregar bin: "+err.message); }}

async function pasteFromClipboard() {Â  Â  try {Â  Â  Â  Â  const text = await navigator.clipboard.readText();Â  Â  Â  Â  if (text) {Â  Â  Â  Â  Â  Â  document.getElementById('rawText').value = text;Â  Â  Â  Â  } else {Â  Â  Â  Â  Â  Â  alert('Sua Ã¡rea de transferÃªncia estÃ¡ vazia.');
Â  Â  Â  Â  }Â  Â  } catch (err) {Â  Â  Â  Â  console.error('Falha ao colar texto: ', err);Â  Â  Â  Â  alert('NÃ£o foi possÃ­vel ler da Ã¡rea de transferÃªncia.');Â  Â  }}

// =======================================================
// FUNÃ‡Ã•ES DO EDITOR MANUAL
// =======================================================
function openManualEditor() {Â  Â Â 
Â  Â  const editorList = document.getElementById('editor-list');Â  Â Â 
Â  Â  const manualEditorModal = document.getElementById('manual-editor-modal');Â  Â Â 
Â  Â  const text = rawTextArea.value;Â  Â Â 
Â  Â Â 
Â  Â  if (!text.trim()) {Â  Â  Â  Â Â 
Â  Â  Â  Â  alert('A caixa de texto estÃ¡ vazia.');
Â  Â  Â  Â  return;
Â  Â  }
Â  Â Â 
Â  Â  const periods = sent_tokenize_browser(text).map(s => s.trim()).filter(Boolean);
Â  Â  editorList.innerHTML = '';
Â  Â Â 
Â  Â  periods.forEach(period => {
Â  Â  Â  Â  const itemDiv = document.createElement('div');
Â  Â  Â  Â  itemDiv.className = 'editor-item';
Â  Â  Â  Â  
// Adicionamos um novo botÃ£o com a classe 'add-period-btn'
itemDiv.innerHTML = `
    <p contenteditable="true">${period}</p>
    <div class="editor-item-controls">
        <button class="add-period-btn" onclick="insertNewPeriodAfter(this)" title="Adicionar perÃ­odo abaixo">+</button>
        <button class="delete-period-btn" onclick="this.parentElement.parentElement.remove()" title="Apagar este perÃ­odo">&times;</button>
    </div>
`;

Â  Â  Â  Â  editorList.appendChild(itemDiv);
Â  Â  });
Â  Â Â 
Â  Â  manualEditorModal.style.display = 'flex';
}

function closeManualEditor() {Â  Â Â 
Â  Â  document.getElementById('manual-editor-modal').style.display = 'none';
}

function saveManualChanges() {Â  Â Â 
Â  Â  const editorList = document.getElementById('editor-list');Â  Â Â 
Â  Â  const remainingItems = editorList.querySelectorAll('.editor-item p');Â  Â Â 
Â  Â  let newText = [];Â  Â Â 
Â  Â Â 
Â  Â  remainingItems.forEach(item => newText.push(item.textContent.trim()));Â  Â Â 
Â  Â Â 
Â  Â  rawTextArea.value = newText.join(' ');Â 
Â  Â Â 
Â  Â  closeManualEditor();
Â  Â  updateCounters();Â 
}
// =======================================================

function countWords(text) {
Â  Â  const cleanText = text.trim().replace(/\s+/g, ' ');
Â  Â  if (cleanText === '') return 0;
Â  Â  return cleanText.split(' ').length;
}

function updateCounters() {
Â  Â  const rawText = document.getElementById('rawText').value;
Â  Â  const processedText = document.getElementById('processedText').value;

Â  Â  const rawCharCount = rawText.length;
Â  Â  const rawWordCount = countWords(rawText);
Â  Â Â 
Â  Â  const processedCharCount = processedText.length;
Â  Â  const processedWordCount = countWords(processedText);

Â  Â  document.getElementById('rawTextCounter').textContent = `(${rawWordCount} palavras, ${rawCharCount} caracteres)`;
Â  Â  document.getElementById('processedTextCounter').textContent = `(${processedWordCount} palavras, ${processedCharCount} caracteres)`;
}
/**
 * Insere uma nova cÃ©lula de perÃ­odo em branco logo apÃ³s o item de referÃªncia.
 * @param {HTMLElement} buttonElement - O botÃ£o '+' que foi clicado.
 */
function insertNewPeriodAfter(buttonElement) {
    // 1. A partir do botÃ£o, encontra o item da lista (a div 'editor-item') que o contÃ©m.
    const currentItem = buttonElement.closest('.editor-item');

    // 2. Cria a nova cÃ©lula (div 'editor-item') que serÃ¡ inserida.
    const newItem = document.createElement('div');
    newItem.className = 'editor-item';

    // 3. Define o HTML da nova cÃ©lula, que tambÃ©m precisa ter os botÃµes de adicionar e apagar.
    newItem.innerHTML = `
        <p contenteditable="true"></p>
        <div class="editor-item-controls">
            <button class="add-period-btn" onclick="insertNewPeriodAfter(this)" title="Adicionar perÃ­odo abaixo">+</button>
            <button class="delete-period-btn" onclick="this.parentElement.parentElement.remove()" title="Apagar este perÃ­odo">&times;</button>
        </div>
    `;

    // 4. Esta Ã© a linha mais importante: Insere a nova cÃ©lula criada
    //    imediatamente apÃ³s o item atual na estrutura do HTML.
    currentItem.insertAdjacentElement('afterend', newItem);

    // 5. Coloca o foco do cursor na nova cÃ©lula para o usuÃ¡rio jÃ¡ poder digitar.
    newItem.querySelector('p').focus();
}
</script>



</body>
</html>