<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>memo22 - Leitor Minimalista</title>
<style>

body {
  font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f2f4f7; /* cinza claro suave */
  color: #222;
  margin: 0;
  padding: 30px;
  display: flex;
  flex-direction: column;
  align-items: center;
  transition: background 0.3s;
}

h2 {
  margin-bottom: 5px;
  color: #2c3e50; /* azul escuro suave */
}

h3 {
  margin: 20px 0 10px;
  color: #34495e;
}

/* caixa de busca */
#searchInput {
  padding: 10px 14px;
  border-radius: 12px;
  border: 1px solid #ccc;
  min-width: 220px;
  font-size: 15px;
  background: #fff;
  transition: all 0.2s ease;
}
#searchInput:focus {
  outline: none;
  border-color: #4a90e2;
  box-shadow: 0 0 8px rgba(74,144,226,0.2);
}

/* caixa principal de entrada */
textarea {
  width: 100%;
  max-width: 820px;
  border: 1px solid #ccc;
  border-radius: 12px;
  padding: 12px 14px;
  resize: vertical;
  font-size: 16px;
  background: #fff;
  transition: box-shadow 0.3s, border-color 0.3s;
}
textarea:focus {
  outline: none;
  border-color: #4a90e2;
  box-shadow: 0 0 10px rgba(74,144,226,0.25);
}

/* caixa de texto processado */
#processedText {
  width: 100%;
  max-width: 820px;
  height: 140px;
  margin-top: 12px;
  border-radius: 12px;
  border: 1px solid #ccc;
  padding: 12px 14px;
  font-size: 16px;
  background: #fff;
  resize: vertical;
  transition: all 0.2s ease;
}
#processedText:focus {
  outline: none;
  border-color: #27ae60;
  box-shadow: 0 0 10px rgba(39,174,96,0.25);
}

/* bot√µes e controles */
button, input, select {
  margin: 6px;
  padding: 10px 14px;
  border-radius: 12px;
  border: 1px solid #ccc;
  background: #fff;
  cursor: pointer;
  font-size: 15px;
  font-family: inherit;
  transition: all 0.2s ease;
}

button {
  background: #4a90e2;
  color: #fff;
  border: none;
  font-weight: 500;
}

button:hover {
  background: #357ABD;
  transform: translateY(-1px);
}

.controls {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  margin-top: 15px;
}
.controls button,
.controls select,
.controls input {
  margin: 6px;
}

/* √°rea de sa√≠da */
#output {
  border-radius: 16px;
  padding: 40px;
  margin-top: 20px;
  min-height: 160px;
  width: 100%;
  max-width: 820px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 26px;
  text-align: center;
  background: #ffffff;
  box-shadow: 0 6px 20px rgba(0,0,0,0.06);
  transition: opacity 0.5s, transform 0.3s;
}

.motivation {
  color: #27ae60; /* verde sereno para refor√ßo positivo */
  font-weight: bold;
  animation: blink 0.6s ease-in-out 2;
}

@keyframes blink {
  0%,100% { opacity: 1; }
  50% { opacity: 0.4; }
}


</style>
</head>
<body>
<h2>memo22 - Leitor Minimalista</h2>

<h3>Texto Bruto</h3>
<textarea id="rawText" rows="6" placeholder="Cole seu texto aqui..."></textarea><br>
<div class="controls">
  <button onclick="generateSentences()">üìå Gerar frases</button>
  <button onclick="generateSmartSummary()">üìù Resumo inteligente</button>
  <button onclick="clearRawText()">üóëÔ∏è Limpar</button>
   <input type="text" id="searchInput" placeholder="Pesquisar no Google..." aria-label="Pesquisar no Google">
  <button onclick="searchGoogle()">üîç Pesquisar Google</button>
  <button onclick="importFromLink()">üìé Importar texto de link</button>
</div>

<h3>Texto Processado</h3>
<textarea id="processedText" placeholder="Frases extra√≠das ou resumidas aparecer√£o aqui..."></textarea>
<button onclick="syncProcessedText()">üîÑ Atualizar do Processado</button>


<h3>Configura√ß√µes de Fonte</h3>
<div class="controls">
  <label>Tamanho: <input type="number" id="fontSize" value="24" min="12" max="60"></label>
  <label>Cor: <input type="color" id="fontColor" value="#111111"></label>
  <label>Fonte:
    <select id="fontFamily">
      <option value="Arial">Arial</option>
      <option value="Georgia">Georgia</option>
      <option value="Courier New">Courier New</option>
      <option value="Verdana">Verdana</option>
      <option value="Times New Roman">Times New Roman</option>
    </select>
  </label>
</div>

<h3>Voz</h3>
<div class="controls">
  <select id="voiceSelect"></select>
  <button onclick="toggleVoice()">üîä Ativar/Desativar Voz</button>
  <label>Velocidade: 
    <input type="number" id="voiceRate" value="1" min="0.1" max="3" step="0.1" style="width:60px">
  </label>
</div>

<h3>Frases Motivacionais</h3>
<div class="controls">
  <label>Inserir a cada <input type="number" id="motivationEvery" value="0" min="0" style="width:50px"> frases (0 = desativado)</label>
</div>

<div id="output">Aguardando texto...</div>

<div class="controls">
  <button onclick="startAuto()">‚ñ∂Ô∏è Autom√°tico</button>
  <button onclick="pauseAuto()">‚è∏Ô∏è Pausar</button>
  <button onclick="resetReader()">üîÑ Reset</button>
  <button onclick="manualMode()">üìñ Controle Manual</button>
  <button onclick="prevSentence()">‚¨ÖÔ∏è Voltar</button>
  <button onclick="nextSentence()">‚û°Ô∏è Avan√ßar</button>
</div>

<h3>Gerenciamento de Textos</h3>
<div class="controls">
  <button onclick="exportJSON()">üíæ Exportar JSON</button>
  <input type="file" id="importFile" onchange="importJSON(event)">
</div>

<script>
let sentences=[], currentIndex=0, autoMode=false, voiceEnabled=false;
let voices=[], selectedVoice=null, textReadCounts={};
const output=document.getElementById('output'), voiceSelect=document.getElementById('voiceSelect');
const motivationalPhrases=[
  "Continue firme, voc√™ est√° indo bem!",
  "Mais uma frase! Foque e avance!",
  "Voc√™ est√° se superando a cada leitura!",
  "Mantenha o ritmo, sua mente agradece!",
  "A const√¢ncia traz o resultado!",
  "Respire fundo, voc√™ est√° no caminho certo!",
  "Seu foco est√° criando resultados!"
];

// ===== Vozes =====
function loadVoices(){
  voices=speechSynthesis.getVoices();
  voiceSelect.innerHTML="";
  voices.forEach((v,i)=>{
    let o=document.createElement("option"); o.value=i; o.textContent=`${v.name} (${v.lang})`; voiceSelect.appendChild(o);
  });
  if(voices.length>0) selectedVoice=voices[0];
}
speechSynthesis.onvoiceschanged=loadVoices;
voiceSelect.addEventListener("change",()=>{ selectedVoice=voices[voiceSelect.value]; });

// ===== Fun√ß√µes de Texto =====
function generateSentences(){
  const text=document.getElementById('rawText').value;
  if(!text.trim()) return;
  sentences=text.split(/(?<=\.)\s+/).map(s=>s.trim()).filter(Boolean);
  sentences=insertMotivation(sentences);
  currentIndex=0;
  document.getElementById('processedText').value=sentences.join("\n\n");
  showCurrent();
}

function generateSmartSummary(){
    const text = document.getElementById('rawText').value;
  if(!text.trim()) return;

  const stopwords=["de","do","da","e","a","o","que","em","um","uma","para","com","n√£o","se","por","os","as","no","na","dos","das"];
  
  // 1. Separar em senten√ßas
  const sents = text.split(/(?<=\.)\s+/).map(s => s.trim()).filter(Boolean);

  // 2. Contar frequ√™ncia de palavras (ignorando stopwords)
  const freq = {};
  sents.forEach(s => {
    s.split(/\s+/).forEach(w => {
      const word = w.toLowerCase().replace(/[.,!?]/g,'');
      if(!stopwords.includes(word)){
        freq[word] = (freq[word] || 0) + 1;
      }
    });
  });

  // 3. Pontuar cada senten√ßa
  const scored = sents.map(s => {
    const score = s.split(/\s+/).reduce((a, w) => {
      const word = w.toLowerCase().replace(/[.,!?]/g,'');
      return a + (freq[word] || 0);
    }, 0);
    return {text: s, score};
  });

  // 4. Selecionar top 3-5 senten√ßas mais relevantes
  scored.sort((a,b)=>b.score-a.score);
  const summary = scored.slice(0, Math.min(5, scored.length)).map(s=>s.text);

  sentences = insertMotivation(summary);
  currentIndex = 0;
  document.getElementById('processedText').value = sentences.join("\n\n");
  showCurrent();
}

function syncProcessedText(){
  const edited = document.getElementById('processedText').value;
  sentences = edited.split(/\n\s*\n/).map(s => s.trim()).filter(Boolean);
  currentIndex = 0;
  showCurrent();
}


function insertMotivation(arr){
  const every=parseInt(document.getElementById('motivationEvery').value)||0;
  if(every<=0) return arr;
  let final=[];
  for(let i=0;i<arr.length;i++){
    final.push(arr[i]);
    if((i+1)%every===0 && i!==arr.length-1){
      final.push(motivationalPhrases[Math.floor(Math.random()*motivationalPhrases.length)]);
    }
  }
  return final;
}

function clearRawText(){document.getElementById('rawText').value="";document.getElementById('processedText').value="";sentences=[];output.textContent="Texto apagado.";}
function searchGoogle(){
  const q = document.getElementById('searchInput').value.trim();
  if(q){
    // Abre nova aba. Como foi chamado por clique direto do usu√°rio, normalmente n√£o √© bloqueado.
    window.open(`https://www.google.com/search?q=${encodeURIComponent(q)}`, "_blank");
  } else {
    alert("Digite algo para pesquisar.");
    document.getElementById('searchInput').focus();
  }
}


// ===== Importar de link via servidor =====
async function importFromLink(){
  const url=prompt("Cole o link do site (modo texto recomendado):");
  if(!url) return;
  try{
    const res=await fetch(`http://localhost:3000/extract-text?url=${encodeURIComponent(url)}`);
    const data=await res.json();
    if(data.text){
      document.getElementById('rawText').value=data.text;
      alert("Texto extra√≠do com sucesso!");
    } else { alert("N√£o foi poss√≠vel extrair o texto."); }
  } catch(err){ alert("Erro ao importar o texto: "+err.message); }
}

// ===== Mostrar Frase =====
function showCurrent(){
  if(!sentences.length){output.textContent="Nenhuma frase gerada."; return;}
  output.style.fontSize=document.getElementById('fontSize').value+"px";
  output.style.color=document.getElementById('fontColor').value;
  output.style.fontFamily=document.getElementById('fontFamily').value;

  // anima√ß√£o para motiva√ß√£o
  const text=sentences[currentIndex];
  if(motivationalPhrases.includes(text)){
    output.innerHTML=`<span class="motivation">${text}</span>`;
  } else { output.textContent=text; }
}

function speakCurrent(){
  const text = sentences[currentIndex];
  if(!voiceEnabled || !selectedVoice){
    if(autoMode) nextSentenceAuto();
    return;
  }
  speechSynthesis.cancel();
  const utter = new SpeechSynthesisUtterance(text);
  utter.voice = selectedVoice;
  const rate = parseFloat(document.getElementById('voiceRate').value) || 1;
  utter.rate = rate;
  utter.onend = () => {
    incrementReadCount(document.getElementById('rawText').value);
    if(autoMode) nextSentenceAuto();
  };
  speechSynthesis.speak(utter);
}

function incrementReadCount(text){
  const hash=hashCode(text);
  textReadCounts[hash]=(textReadCounts[hash]||0)+1;
}

function hashCode(str){let hash=0; for(let i=0;i<str.length;i++){hash=((hash<<5)-hash)+str.charCodeAt(i);hash|=0;} return hash;}

// ===== Controle Autom√°tico =====
function startAuto(){ if(!sentences.length) return; autoMode=true; currentIndex=0; showCurrent(); speakCurrent(); }
function nextSentenceAuto(){ if(!autoMode || !sentences.length) return; currentIndex=(currentIndex+1)%sentences.length; showCurrent(); speakCurrent(); }
function pauseAuto(){ autoMode=false; speechSynthesis.cancel(); }
function resetReader(){ pauseAuto(); currentIndex=0; showCurrent(); }
function manualMode(){ pauseAuto(); showCurrent(); }
function nextSentence(){ currentIndex=(currentIndex+1)%sentences.length; showCurrent(); if(voiceEnabled) speakCurrent(); }
function prevSentence(){ currentIndex=(currentIndex-1+sentences.length)%sentences.length; showCurrent(); if(voiceEnabled) speakCurrent(); }
function toggleVoice(){ voiceEnabled=!voiceEnabled; alert("Voz "+(voiceEnabled?"ativada":"desativada")); }

// ===== Export/Import JSON =====
function exportJSON(){ const data={sentences,textReadCounts}; const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='memo22_textData.json'; a.click(); URL.revokeObjectURL(url);}
function importJSON(event){ const file=event.target.files[0]; if(!file) return; const reader=new FileReader(); reader.onload=(e)=>{ try{ const data=JSON.parse(e.target.result); if(data.sentences) sentences=data.sentences; if(data.textReadCounts) textReadCounts=data.textReadCounts; currentIndex=0; document.getElementById('processedText').value=sentences.join("\n\n"); showCurrent(); alert("JSON importado com sucesso!"); }catch(err){alert("Erro ao importar JSON: "+err);}}; reader.readAsText(file);}
</script>
</body>
</html>
